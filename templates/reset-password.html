{% extends '/base/style/base.html' %}
{% block content %}
<section class="error-wrap bg-light">
  <div class="container">
    <div class="row justify-content-center align-content-center" style="height: 60vh;">
      <div class="col-lg-5 bg-white col-md-8 p-5 text-center rounded shadow">
        <h2>Reset Your Password</h2>
        <div id="form-wrapper">
          <input type="password" id="new-password" class="form-control mt-3" placeholder="New password">
          <button class="btn btn-primary mt-3" onclick="resetPassword()">Reset Password</button>
        </div>
        <p id="message" class="mt-3"></p>
      </div>
    </div>
  </div>
</section>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "{{ firebase_config.apiKey }}",
    authDomain: "{{ firebase_config.authDomain }}"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  const actionCode = "{{ oob_code }}";

  function resetPassword() {
    const newPassword = document.getElementById('new-password').value;
    const message = document.getElementById('message');

    const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

    if (!newPassword || !passwordPattern.test(newPassword)) {
    message.textContent = "Password must be at least 8 characters and include uppercase, lowercase, number, and special character.";
    return;
    }


    auth.confirmPasswordReset(actionCode, newPassword)
      .then(() => {
        message.textContent = "Password reset successful. Redirecting to login...";
        setTimeout(() => {
          window.location.href = "/login";
        }, 3000);
      })
      .catch(error => {
        message.textContent = "Password reset failed: " + error.message;
      });
  }
</script>
{% endblock %}